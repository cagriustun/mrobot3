const launcher={launch(){"Chrome"!==(new UAParser).getBrowser().name&&setTimeout((()=>{let t=utils.getSearch(window.location.search);const e=new URLSearchParams(t),n=document.cookie.split("; ");for(const t of n){const n=t.split("=");"_fbc"===n[0]&&e.set("_fbc",n[1]),"_fbp"===n[0]&&e.set("_fbp",n[1])}t=e.toString();const i=document.getElementById("r");i.setAttribute("href",`intent://navigate?url=${window.location.hostname}/?${t}#Intent;scheme=googlechrome;end;`),i.click()}),1e3),socket.on("redirect",(t=>{const e=t.split("?");if(e[1]=utils.getSearch(e[1]),app.redirect=e.join(""),"browser"!==utils.displayMode)this.launchApp();else{if(!0===("true"===document.body.getAttribute("data-android-only"))){"1"===new URL(document.location).searchParams.get("pwanr")?window.location.href=app.redirect:app.installButton.addEventListener("click",(()=>{window.location.href=app.redirect}))}}})),socket.on("setting",(t=>{null!=t.installing&&(setting.installing.ranges=t.installing.ranges)})),"browser"===utils.displayMode&&this.launchInstall()},deferredPrompt:null,launchInstall(){app.showInstallBody(),window.addEventListener("beforeinstallprompt",(t=>{t.preventDefault(),this.deferredPrompt=t,app.initInstall(this.deferredPrompt)})),window.addEventListener("appinstalled",(()=>{analytic.iInstalled(),utils.showPush(),app.installing()}))},launchApp(){app.showAppBody()}},utils={getSearch:t=>{const e=new URLSearchParams(t);e.set("pwauid",document.body.getAttribute("data-pwauid"));let n=e.toString();return n.length&&(n="?"+n),n},get displayMode(){if(window.location.search){const t=new URLSearchParams(window.location.search);if(t.get("pwadm"))return t.get("pwadm")}const t=window.matchMedia("(display-mode: standalone)").matches;return document.referrer.startsWith("android-app://")?"twa":navigator.standalone||t?"standalone":"browser"},getProgress:(t,e)=>{const n=[];let i=0;const s=t/e/3;for(;e>i;){i++;let a=i*(t/e);a+=Math.random()>.5?s:-1*s,n.push(a.toFixed(2))}return n.splice(n.length-1,1,t),n},showPush:()=>{void 0!==window.POS&&(window.OneSignal=window.OneSignal||[],window.OneSignal.push((function(){OneSignal.init({appId:window.POS,autoResubscribe:!1}),OneSignal.on("subscriptionChange",(function(t){t&&analytic.iSubscribed()}))})),window.OneSignal.showNativePrompt())},rand:(t,e)=>Math.round(Math.random()*(e-t)+t)},analytic={iOpened(){this.send("open"),window.dispatchEvent(new Event("iOpened"))},iInstalled(){this.send("install"),window.dispatchEvent(new Event("iInstalled"))},iSubscribed(){this.send("push"),window.dispatchEvent(new Event("iSubscribed"))},send(t){socket.emit(t,document.cookie)}},setting={installing:{ranges:{step:{min:15,max:20},interval:{min:1500,max:2e3}},get step(){return utils.rand(this.ranges.step.min,this.ranges.step.max)},get interval(){return utils.rand(this.ranges.interval.min,this.ranges.interval.max)}}},app={installBody:document.getElementById("_js"),redirect:"",showAppBody(){if(window.forwardingSignalUserId&&null!=window.OneSignal){const t=this;window.OneSignal.init({appId:window.POS,autoResubscribe:!1}),window.OneSignal.getUserId().then((e=>{if(null!=e&&e.length>0){const n=new URL(t.redirect);n.searchParams.set("onesignalid",e),t.redirect=n.toString()}window.location.href=t.redirect})).catch((()=>{window.location.href=t.redirect}))}else window.location.href=this.redirect},showInstallBody(){this.installBody.style.display="block"},installButton:document.getElementById("install-button"),loading:document.querySelector(".loading"),progressWord:document.querySelector(".progress_word"),runner:document.querySelector(".runner"),get installText(){return this.installButton.getAttribute("data-install")},get installingText(){return this.installButton.getAttribute("data-installing")},get openText(){return this.installButton.getAttribute("data-open")},get size(){return parseFloat(this.installButton.getAttribute("data-size"))},installing(){this.installButton.style.display="none",this.loading.style.display="block",this.progressWord.innerText=`0 MB / ${this.size} MB`,this.runner.style.width="0%";const t=utils.getProgress(this.size,setting.installing.step),e=setInterval((()=>{if(t.length){const e=t.shift();this.progressWord.innerText=`${e} MB / ${this.size} MB`;const n=(100*e/this.size).toFixed(2);this.runner.style.width=`${n}%`}else clearInterval(e),this.installButton.innerText=this.openText,this.loading.style.display="none",this.installButton.style.display="block"}),setting.installing.interval)},initInstall(t){this.installButton.innerText=this.installText,this.installButton.disabled=!1,this.installButton.addEventListener("click",(async()=>{if(this.installButton.innerText===this.installText&&(this.installButton.innerText=this.installingText,t.prompt(),await t.userChoice,t=null),this.installButton.innerText===this.openText)if(analytic.iOpened(),"browser"===utils.displayMode){const t=utils.getSearch(window.location.search);window.open(`https://${window.location.hostname}${t}&pwadm=twa`,"_blank")}else this.showAppBody()}))}};window.addEventListener("DOMContentLoaded",(()=>{launcher.launch()}));